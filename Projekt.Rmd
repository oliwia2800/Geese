---
title: "Kredyty"
author: "Geese"
date: "2024-11-21"
output: html_document
  rmdformats::readthedown
  highlight: kate
---

# Kredyty

## Wprowadzenie

Celem projektu jest analiza danych dotyczących udzielania kredytów hipotecznych i zidentyfikowanie, które czynniki mają wpływ na to, czy kredytobiorca regularnie spłaca kredyt, czy nie.\

W pierwszym etapie analizy zapoznano się z danymi. Baza składała się z 250 000 rekordów. W związku z tym skonsultowano się z prowadzącym i wybrano 20 kluczowych kolumn. Odnoszą się one do kredytobiorcy:

-   TARGET - spłaca kredyt regularnie (0), ma z tym problemy (1);

-   NAME_CONTRACT_TYPE - określenie, czy kredyt jest gotówkowy, czy odnawialny;

-   CODE_GENDER - płeć (M - mężczyzna, F - kobieta);

-   FLAG_OWN_REALTY - fakt posiadania nieruchomości (1 - tak, 0 - nie)

-   CNT_CHILDREN - liczba dzieci;

-   AMT_INCOME_TOTAL - całkowity roczny dochód;

-   AMT_CREDIT - całkowita kwota kredytu;

-   NAME_INCOME_TYPE - źródło dochodu;

-   NAME_EDUCATION_TYPE - poziom edukacji;

-   NAME_FAMILY_STATUS - status rodzinny;

-   NAME_HOUSING_TYPE - sytuacja mieszkaniowa;

-   ORGANIZATION_TYPE - miejsce pracy;

-   REGION_RATING_CLIENT - ocena na skali porządkowej miejsca zamieszkania;

-   OCCUPATION_TYPE - typ zawodu;

-   APARTMENTS_AVG - średnia znormalizowana powierzchnia mieszkalna;

-   BASEMENTAREA_AVG - średnia znormalizowana powierzchnia piwnicy;

-   YEARS_BUILD_AVG - średni znormalizowany wiek nieruchomości;

-   COMMONAREA_AVG - średnia znormalizowana powierzchnia ewentualnej części wspólnej;

-   ENTRANCES_AVG - średnia znormalizowana liczba wejść;

-   LANDAREA_AVG - średnia znormalizowana powierzchnia terenu posesji.

Po wybraniu zmiennych z najważniejszymi informacjami, ustalono ziarno generatora i wylosowano 2500 obserwacji do dalszej analizy. Jako najbardziej istotną uznano zmienną binarną TARGET, która mówi o tym, czy dana osoba regularnie spłaca kredyt.\

## Braki w danych

W początkowym etapie analizy danych przystąpiono do identyfikacji braków danych.

```{r, echo=FALSE}
NA_count
```

Na podstawie wyniku można wywnioskować, że baza danych ma 9409 braków w obserwacjach.

Następnie sprawdzono, w jakiej występują one propocji do całego zbioru i przedstawiono ten wynik w postaci procentowej.\

```{r, echo=FALSE}
NA_proportion
NA_percentage
```

Stwierdzono, że braki danych stanowią 18,818% wszystkich obserwacji.

W celu dogłębniejszej ich analizy zbadano, ile jest braków w danej kolumnie oraz w jakiej proporcji procentowej w niej występują.

```{r, echo=FALSE}
NA_summary
```

Braki danych wystąpiły w kolumnach: COMMONAREA_AVG, YEARS_BUILD_AVG, LANDAREA_AVG, BASEMENTAREA_AVG, APARTMENTS_AVG, ENTRANCES_AVG i OCCUPATION_TYPE. Dla pozostałych kolumn nie zdiagnozowano braków.\

Podjęto się również wizualizacji braków danych na poniższym wykresie:

```{r, echo=FALSE}
vis_miss(Data, warn_large_data=FALSE)
```

Dodatkowym krokiem w analizie braków danych było stworzenie podsumowania, które analizuje, w ilu wierszach wystąpiło od zera do siedmiu braków danych oraz jaki jest to stosunek procentowy.

```{r, echo=FALSE}
NA_summary_case
```

Podjęto się również wizualizacji braków danych na poniższym wykresie: Na podstawie braków danych, opierając się na zmiennej TARGET, stworzono mapę cieplną.

```{r, echo=FALSE}
vis_miss(Data, warn_large_data=FALSE)
target_heat_mapa <- gg_miss_fct(Data, fct = TARGET)
print(target_heat_mapa)
```

PO TYM DODAĆ GGPLOTA Z KOMPLETNOŚCIĄ DANYCH I OPISAĆ, BO TEGO TU BRAKUJE Z GŁÓWNEGO KODU

Mapa cieplna ukazała procentowy udział braków danych w całym zbiorze. Skala zbudowana jest na kolorach od fioletowego do żółtego, gdzie fiolet oznacza 0%, a żółty 100%.\

Następnie stworzono wykres upset plot, który służy do wizualizacji braków danych lub analiz złożonych relacji między grupami cech.\
Oś pionowa wykresu pokazuje liczebność danych dla poszczególnych kombinacji braków w kolumnach. Najwyższe słupki wskazują najczęściej występujące zestawy braków w danych.\
Kropki i linie na osi poziomej poniżej słupków wskazują, które kolumny mają braki dla danej grupy.\
W przypadku pojedynczych kropek brak dotyczy jednej kolumny, a linie między kropkami oznaczają brak danych w kilku kolumnach równocześnie.\
Lewy dolny wykres wyświetla całkowitą liczbę brakujących wartości dla każdej kolumny z osobna, co pozwala ocenić, które zmienne są najbardziej dotknięte brakami.

```{r, echo=FALSE}
gg_miss_upset(Data, nsets = 122)
```

Najczęstsze kombinacje braków dotyczą kilku kolumn jednocześnie (814 przypadków), co sugeruje, że brak danych może być skorelowany w tych zmiennych. Kolumny takie jak COMMONAREA_AVG_NA czy YEARS_BUILD_AVG_NA mają największe liczby braków.

Podjęto się stworzenia również innej wizualizacji braków danych. Wykres po lewej przedstawia proporcje braków w zależności od TARGET. Na osi poziomej znajdują się wartości zmiennej TARGET. Natomiast na osi pionowej przedstawiona jest proporcja braków w danych.\
Wykres po prawej przedstawia macierz kombinacji braków. Na osi poziomej przedstawiono kombinacje braków danych w różnych kolumnach, a oś pozioma prezentuje wiersze w danych. Niebieskie pola przedstawiają komórki uzupełnione, a czerwone - braki danych. Z macierzy kombinacji braków można wywnioskować, że wzorce są wielowymiarowe, gdyż braki pojawiają się dla więcej niż jednej zmiennej. W kilku przypadkach można również stwierdzić, że braki są monotoniczne tak jak np. w ostatnim rekordzie. Można na tej podstawie przypuścić, że brak w jednej kolumnie przyczynił się do powstania braku w kolejnej. Wzorce są również w dużej mierze ze sobą połączone.

```{r, echo=FALSE}
VIM::aggr(Data_implications[,1:20])
```

Na wykresie po lewej wartości zmiennej TARGET są powiązane z różnym udziałem braków w danych. Wyższe słupki przy jednej z wartości TARGET wskazują, że w tej grupie braki występują częściej.\
Na drugim wykresie zgrupowane braki mogą sugerować, że braki w danych są skorelowane i występują wspólnie w określonych zmiennych.\
Z obu wykresów można zatem wnioskować, że brakujące wartości mogą występować częściej dla określonych grup TARGET.\
W celu pracy nad brakami danych, zamieniono wartości specjalne tj. Inf na NA. Dokonano tego za pomocą poniżej procedury:

```{r, echo=FALSE}
is.special <- function(x){
  if (is.numeric(x)) !is.finite(x) else is.na(x)
}
 
sapply(Data, is.special)
 
for (n in colnames(Data)){
  is.na(Data[[n]]) <- is.special(Data[[n]])
}
```

Następnie przeprowadzono test Grubbsa, który sprawdza, czy w zbiorze danych występują wartości odstające.

```{r, echo=FALSE}
test_grubbs <- function(column) {
  if (length(column) > 2) { 
    result <- grubbs.test(column)
    return(result)
  } else {
    return(NA) 
  }
}
 
results_grubbs <- lapply(data_numeric, test_grubbs)
results_grubbs

```

Dla testu postawiono dwie hipotezy:\
- H₀: Nie ma wartości odstających w zbiorze wartości badanej zmiennej.\
- H₁: Największa lub najmniejsza wartość w zbiorze jest outlierem. Dla zmiennych AMT_INCOME_TOTAL, AMT_CREDIT, APARTMENTS_AVG, ENTRANCES_AVG, CNT_CHILDREN i YEARS_BUILD_AVG wartość p\<0.05, co dla poziomu istotności α=0.05 oznacza, że odrzucamy hipotezę zerową i najmniejsza lub największa wartość jest outlierem. W przypadku pozostałych zmiennych nie ma podstaw do odrzucenia hipotezy zerowej, co oznacza, że nie wykryto obserwacji odstających.

Następnie skorzystano z metody Hot-deck imputation, mającej na celu uzupełnienie braków danych w posiadanym zbiorze.

```{r, echo=FALSE}
Data_hotdeck<- Data_implications %>%
  group_by(TARGET) %>%
  group_modify(~ hotdeck(.x)) %>%
  ungroup()
```

Program uzupełnił zidentyfikowane braki danych na podstawie innych podobnych rekordów. Działa to na zasadzie "biorcy" i "dawcy". W zbiorze wyszukiwane są wartości odpowiadające szukanym pod względem zmiennych, następnie pobierane od "biorcy" i przypisywane "dawcy".\
Kolejnym krokiem było ustalenie reguł dla poszczególnych zmiennych w celu sprawdzenia poprawności danych w zbiorze. Dla danych jakościowych o skończonej liczbie wartości, ale wielu wariantach trudnych do zidentyfikowania zdecydowano się sprawdzenie poprawności poprzez stworzenie tabeli.

```{r, echo=FALSE}
table(Data_hotdeck$NAME_INCOME_TYPE)
table(Data_hotdeck$NAME_EDUCATION_TYPE)
table(Data_hotdeck$NAME_FAMILY_STATUS)
table(Data_hotdeck$NAME_HOUSING_TYPE)
table(Data_hotdeck$ORGANIZATION_TYPE)
table(Data_hotdeck$OCCUPATION_TYPE)
```

Na tej podstawie zidentyfikowano niepoprawne dane w kolumnie ORGANIZATION_TYPE, gdyż zauważono wartości XNA w ilości 470.\
Następnie sporządzono reguły dla pozostałych kolumn w zbiorze danych.

```{r, echo=FALSE}
rules <- validator(TARGET == 1 | TARGET == 0, 
                   NAME_CONTRACT_TYPE == "Cash loans" | NAME_CONTRACT_TYPE == "Revolving loans",
                   CODE_GENDER == "M" | CODE_GENDER == "F",
                   FLAG_OWN_REALTY == "Y" | FLAG_OWN_REALTY == "N",
                   CNT_CHILDREN >= 0,
                   CNT_CHILDREN < 30,
                   AMT_INCOME_TOTAL >= 0,
                   AMT_CREDIT > 0,
                   REGION_RATING_CLIENT >= 1,
                   REGION_RATING_CLIENT <= 3,
                   APARTMENTS_AVG >= 0, 
                   BASEMENTAREA_AVG >= 0, 
                   YEARS_BUILD_AVG >= 0, 
                   COMMONAREA_AVG >= 0, 
                   ENTRANCES_AVG >= 0, 
                   LANDAREA_AVG >= 0,
                   APARTMENTS_AVG <= 1, 
                   BASEMENTAREA_AVG <= 1,
                   YEARS_BUILD_AVG <= 1, 
                   COMMONAREA_AVG <= 1, 
                   ENTRANCES_AVG <= 1,
                   LANDAREA_AVG <= 1, 
                   ORGANIZATION_TYPE != "XNA")
```

Dla kolumn z danymi binarnymi, do których należą zmianne TARGET, NAME_CONTRACT_TYPE, CODE_GENDER i FLAG_OWN_REALTY sporządzono reguły mające na celu zidentyfikowanie jeśli, w którymś z rekordów znajdzie się wyrażenie inne niż wskazane. Następnie dla kolumn od CNT_CHILDREN do LANDAREA_AVG stworzono regułu liczbowe dla znajdujących się w nich danych ilościowych. Ostatnia reguła miałą na celu zidentyfikować rekordy, w których pojawiło się wyrażenie "XNA" w kolumnie ORGANIZATION_TYPE.\
Wykorzystano funkcję confront, by sprawdzić czy dane spełniają ustalone reguły.\

```{r, echo=FALSE}
results <- confront(Data_hotdeck, rules, key="TARGET")
summary(results)
```

W wyniku tego działania ustalono, że 7 rekordów nie przeszło walidacji w kolumnie BASEMENTAREA_AVG, 11 w kolumnie COMMONAREA_AVG, 2 w kolumnie LANDAREA_AVG i 470 w kolumnie ORGANIZATION_TYPE. Stworzono także wykres pokazujący stosunek rekordów zgodnych z regułami do tych, które nie przeszły walidacji dla poszczególnych zmiennych.

```{r, echo=FALSE}
barplot(results, main="Data_hotdeck")
```

Ustalono, że w niektórych przypadkach dane nie przeszły walidacji, ponieważ zapisano je w nieodpowiednim formacie. Z tego względu zastąpiono je danymi liczbowymi w poprawnym formacie. W tym celu użyto poniższego kodu.\

```{r, echo=FALSE}
Data_hotdeck <- Data_hotdeck %>%
  mutate(BASEMENTAREA_AVG = ifelse(BASEMENTAREA_AVG == "5,00E-04", 0.0005, BASEMENTAREA_AVG)) %>%
  mutate(BASEMENTAREA_AVG = ifelse(BASEMENTAREA_AVG == "1,00E-04", 0.0001, BASEMENTAREA_AVG)) %>%
  mutate(COMMONAREA_AVG = ifelse(COMMONAREA_AVG == "9,00E-04", 0.0009, COMMONAREA_AVG)) %>%
  mutate(COMMONAREA_AVG = ifelse(COMMONAREA_AVG == "8,00E-04", 0.0008, COMMONAREA_AVG)) %>%            
  mutate(COMMONAREA_AVG = ifelse(COMMONAREA_AVG == "7,00E-04", 0.0007, COMMONAREA_AVG)) %>%
  mutate(COMMONAREA_AVG = ifelse(COMMONAREA_AVG == "5,00E-04", 0.0005, COMMONAREA_AVG)) %>%   
  mutate(COMMONAREA_AVG = ifelse(COMMONAREA_AVG == "2,00E-04", 0.0002, COMMONAREA_AVG)) %>%
  mutate(LANDAREA_AVG = ifelse(LANDAREA_AVG == "9,00E-04", 0.0009, LANDAREA_AVG)) 
```

Po eliminacji części błędnych danych postanowiono wykorzystać funkcję simplify_rules, by upewnić się, że reguły zapisano w najprostszy możliwy sposób. Program nie znalazł jednak uproszczonej metody ich zapisywania i nie nastąpiły żadne zmiany.

```{r, echo=FALSE}
rules <- simplify_rules(rules)
```

W celu dalszej eliminacji braków danych (0,9%) zastosowano metodę imputacji brakujących danych za pomocą algorytmu k-Nearest Neighbors (kNN), a wynik został przypisany z powrotem do tego samego zbioru danych.

```{r, echo=FALSE}
Data_hotdeck <- kNN(Data_hotdeck)
```

W uzupełnionym zbiorze danych po skorzystaniu z algorytmu kNN powstały nowe kolumny informujące o zastosowanej imputacji braków danych. Wartości w kolumnach wskazują czy dana wartość została uzupełniona. Zdecydowano się na usunięcie dodanych kolumn.

```{r, echo=FALSE}
Data_hotdeck<- Data_hotdeck[,1:22]
```

Upewniono się, tworząc tabelę dla kolumny ORGANIZATION_TYPE jaki jest rozkład wartości w zmiennej kategorycznej.

```{r, echo=FALSE}
table(Data_hotdeck$ORGANIZATION_TYPE)
```

W następnym etapie projektu, skorzystano z transformacji danych. Skorzystano z procedury stanaryzacji Z-score, aby ułatwić porównywanie rozkładów oraz identyfikację odstających wartości.\
Przedstawiono wizualizację rozkładu standaryzowanych danych APARTMENTS_AVG_Z.

```{r, echo=FALSE}
Data_hotdeck %>% 
  mutate(APARTMENTS_AVG_Z = transform(Data_hotdeck$APARTMENTS_AVG, method = "zscore"))  %>% 
  select(APARTMENTS_AVG_Z) %>% 
  boxplot()
```

Wykres pokazuje, że większość danych mieści się wewnątrz pudełka. Znaczna liczba odstających wartości w górnej części wskazuje, że istnieją obserwacje, które są znacznie większe niż reszta danych. Można zauważyć sporo wartości odstających w górnej części rozkładu, co wskazuje na istnienie ekstremalnie dużych wartości w zmiennej APARTMENTS_AVG po transformacji Z-score. Mogą to być błędy lub anomalie, które wymagają dokładniejszej analizy.

Zdecydowano się również na znalezienie zmiennych oraz ich nazw w naszym zbiorze danych, które powodują problemy ze skośnością, a także odfiltrowano te zmienne, których poziom skośności \> 0,1.

```{r, echo=FALSE}
find_skewness(Data_hotdeck, index=FALSE)
find_skewness(Data_hotdeck, value=TRUE, thres=0.1)
```

Według otrzymanych wyników zmienne, które powodują problem ze skośnością w zbiorze danych to "AMT_INCOME_TOTAL" "AMT_CREDIT", "APARTMENTS_AVG", "YEARS_BUILD_AVG", "ENTRANCES_AVG" oraz "CREDIT_LOG".

Dla poszczególnych sześciu zmiennych stworzono histogramy, aby zwizualizować ich rozkład danych. Dzięki niemu możliwe jest sprawdzenie m.in. czy rozkład jest skośny, czy występują wartości odstające, a także jakie wartości dominują. Histogramy przedstawiają kolejno analizę rozkładu dochodów, rozłożone kwoty kredytów klientów, średnią mieszkań, średni wiek budynków, średnią liczbę wejść do budynków, oraz rozłożoną wartość kredytu.

```{r, echo=FALSE}
hist(Data_hotdeck$AMT_INCOME_TOTAL) 
hist(Data_hotdeck$AMT_CREDIT)
hist(Data_hotdeck$APARTMENTS_AVG)
hist(Data_hotdeck$YEARS_BUILD_AVG)
hist(Data_hotdeck$ENTRANCES_AVG)
hist(Data_hotdeck$CREDIT_LOG)
```

Wcześniejsze kroki analizy potwierdziły się. Histogramy pokazały, że aby przeprowadzić dalszą analizę z wyszczególnionymi zmiennymi,ze wzlędu na występującą skośność konieczne jest dokonanie transformacji zmiennych. Zdecydowano się na dokonanie jej przy użyciu logarytmu.\
Na wyszczególnionych zmiennych dokonano tranformacji oraz przedstawiono wizualizację.

```{r, echo=FALSE}
AIT <- transform(Data_hotdeck$AMT_INCOME_TOTAL, method = "log")
plot(AIT)
AC <- transform(Data_hotdeck$AMT_CREDIT, method = "log")
plot(AC)
AA <- transform(Data_hotdeck$APARTMENTS_AVG, method = "log")
plot(AA)
YBA <- transform(Data_hotdeck$YEARS_BUILD_AVG, method = "log")
plot(YBA)
EA <- transform(Data_hotdeck$ENTRANCES_AVG, method = "log")
plot(EA)
CL <- transform(Data_hotdeck$CREDIT_LOG, method = "log")
plot(CL)
```

Logarytmowanie spowodowało, że dane zostały "spłaszczone", pozwoliło to na zmniejszenie różnic pomiędzy wartościami dużymi i bardzo dużymi, co wpłynęło na bardziej symetryczny rozkładu.

Kolejnym etapem projektu było wykonanie procedury "binningu", aby przekształcić zmienne ilościowe w kategoryczne. Zdecydowano się na zastosowanie tej procedury na dwóch zmiennych, pierwszej dotyczącej dochodu całkowitego oraz drugiej związanej z kwotą kredytu. Obie zmienne podzielono na pięć równych przedziałów o takiej samej szerokości.\
Zmienne już kategoryczne "AMT_INCOME_TOTAL" oraz "AMT_CREDIT" przedstawiono na wykresie.

```{r, echo=FALSE}
data_kat_income <- binning(Data_hotdeck$AMT_INCOME_TOTAL, nbins = 5, type = "equal")
summary(data_kat_income)
plot(data_kat_income)

data_kat_credit <- binning(Data_hotdeck$AMT_CREDIT, nbins = 5, type = "equal")
summary(data_kat_credit)
plot(data_kat_credit)
```

## Wizualizacja danych

### Charakterystyka próby badawczej

Na początku analizy danych podjęto się scharakteryzowania próby badawczej. Na poniższym wykresie przedstawiono rozkład płci na wykresie kołowym.

```{r, echo=FALSE}
ggplot(pie_chart_g) +
  aes(
    x0 = 0, y0 = 0,
    r0 = 0, r = 1,
    amount = n,
    fill = CODE_GENDER
  ) + 
  geom_arc_bar(stat = "pie") +
  coord_fixed() +
  scale_fill_brewer(palette = "Set1")
```

Ze stworzonego wykresu wynika, że zdecydowaną większość próby to kobiety. Stanowią one około 67% populacji, a mężczyzny 33%.\

Na kolejnym wykresie przedstawiono wykres pudełkowy, prezentujących dochód całkowity w zależności od statusu rodziny.

```{r, echo=FALSE}
ggplot(Data_hotdeck, aes(x = INCOME_LOG, fill = NAME_FAMILY_STATUS)) +
  geom_boxplot() +
  xlab("Dochody") +
  ggtitle("Dochód całkowity w zależności od statusu rodziny") +
  scale_fill_brewer(palette = "Set1")
geom_boxplot()
```

Na osi poziomej przedstawiono zlogarytmowane wartości dochodów. Każdy wykres pudełkowy odpowiada innemu statusowi rodziny i prezentuje medianę oraz kwartyle i obserwacje odstające. Civil marriage charakteryzuje się najniższymi wartości z wyraźnymi obserwacjami odstającymi poniżej. Ze statusu married można wywnioskować, że dochody mieszczą się głównie w dolnym zakresie rozkładu. Dochody w statusie separated są bliskie neutralnego poziomu. Status single / not married charakteryzuje się dochodami zbliżonymi do średniego lub nieco wyższe, a status widow tym, że dochody są wyraźnie wyższe.\

Trzeci wykres charakteryzujący próbę prezentuje udział osób spłacających kredyt w zależności od typu nieruchomości.

```{r, echo=FALSE}
ggplot(Data_hotdeck, aes(x = NAME_HOUSING_TYPE, fill = TARGET_2)) +
  geom_bar() +
  xlab("Typ nieruchomości") +
  ggtitle("Udział osób spłacających kredyt w zależności od typu nieruchomości") +
  scale_fill_brewer(palette = "Set1")
```

Z wykresu wynika, że najwięcej osób, które wzięły kredyt, posiadają dom albo mieszkanie. Kolejni kredytobiorcy to osoby mieszkające z rodzicami, zajmujący mieszkania kolumnalne oraz wynajmujący mieszkania. Niewielki odsetek osób stanowią pozostałe nieruchomości.\
Na czerwono zaznaczono osoby, które mają problemy ze spłatą kredytu, a na niebiesko te, które nigdy problemów nie miały. Można zauważyć, że zdecydowaną większość stanowią osoby bez problemów ze spłatą kredytu.

### Analiza danych

W procesie analizy danych kluczowym etapem jest wykorzystanie wizualizacji, która pozwala na skuteczne przedstawienie informacji w sposób intuicyjny i łatwy do interpretacji. W niniejszym rozdziale skupiono się na wizualizacjach przygotowanych na podstawie oczyszczonego i przetworzonego zbioru danych, mających na celu zidentyfikowanie wzorców wskazujących na trudności klientów ze spłatą rat kredytowych.

Dane zostały wcześniej odpowiednio przygotowane, w tym oczyszczone z braków. Ponadto zmienne zostały przekształcone w celu ułatwienia interpretacji, m.in. poprzez standaryzację, transformacje logarytmiczne oraz binning wybranych cech. Dzięki tym krokom możliwe jest uzyskanie precyzyjnych i wiarygodnych wniosków opartych na wizualnej analizie.\
Zdecydowano się na użycie motywu z pakietu ggthemes. Dzięki temu wszystkie wykresy w ggplot2 będą wyglądały schludniej i bardziej estetycznie

```{r, echo=FALSE}
theme_set(theme_few())
```

Stworzono również nową kolumnę "TARGET_2", która przypisuje "Problemy ze spłatą" , jeżeli wartość w kolumnie "TARGET" wynosi 1 oraz przypisuje wartość tekstową "Spłaca", gdy wartość w kolumnie "TARGET" wynosi 0. Ułatwi to interpretację zmiennej oraz będzie bardziej przejrzyste w tworzonych wizualizacjach.

```{r, echo=FALSE}
Data_hotdeck <- Data_hotdeck %>%
  mutate(TARGET_2 = if_else(TARGET == 1, "Problemy ze spłatą", "Spłaca"))
```

W celu stworzenia pierwszej wizualizacji policzono liczbę osób, które nie spłacają kredytu oraz tych, które go spłacają i stworzono nową tabelę. Następnie stworzono wykres kołowy prezentujący zestawienie tych dwóch wartości dla zmiennej.

```{r, echo=FALSE}
pie_chart <- Data_hotdeck %>%
  count(TARGET_2)

ggplot(pie_chart) +
  aes(
    x0 = 0, y0 = 0, 
    r0 = 0, r = 1,  
    amount = n, 
    fill = TARGET_2
  ) + 
  geom_arc_bar(stat = "pie") +  
  coord_fixed() +
  scale_fill_brewer(palette = "Set1")
```

Na przedstawionym wykresie można zauważyć, że zdecydowana większość osób spłaca kredyt.

Kolejna wizualizacja prezentuje Udział osób mających problem ze spłatą kredytu w grupie dochodowej.

```{r, echo=FALSE}
ggplot(Data_hotdeck, aes(x = INCOME_LOG, fill = TARGET_2)) +
  geom_histogram() +
  xlab("Dochód") +
  ggtitle("Udział osób mających problem ze spłatą kredytu w grupie dochodowej") +
  scale_fill_brewer(palette = "Set1")
```

Analizując wykres można powiedzieć, że większość klientów mieści się w środkowym przedziale dochodowym (ok. 11.5–12.5 na osi dochodu w skali logarytmicznej), co wskazuje na koncentrację klientów o przeciętnych dochodach. Problemy ze spłatą kredytu (kolor czerwony) występują w każdej grupie dochodowej, jednak ich proporcja jest różna. Chociaż w dolnych przedziałach dochodowych (poniżej 11.5) liczba klientów jest mała, odsetek problemów ze spłatą wydaje się wyższy w porównaniu do grup o średnich dochodach. Może to wskazywać na większe trudności w spłacie kredytów wśród osób o najniższych dochodach.\
Dochód jest istotnym czynnikiem wpływającym na zdolność do spłaty kredytu. Klienci z niższych grup dochodowych są bardziej narażeni na trudności, podczas gdy osoby z wyższymi dochodami rzadziej mają problemy z regulowaniem zobowiązań.\
Następnie stworzono wykres punktowy przedstawiający zależność zlogarytnowanej zmiennej "wielkość kredytu" od zlogarytowanej warotści "dochodów". Dodatkowo na wykresie rozrózniono płeć kolorem punktów. Kobiety zaznaczono kolorem pomarańczowym, mężczyzn kolorem niebieskim.

```{r, echo=FALSE}
ggplot(Data_hotdeck, aes(x = INCOME_LOG, y = CREDIT_LOG, color = CODE_GENDER))+
  geom_point() +
  xlab("Dochody") +
  ylab("Wielkość kredytu") +
  ggtitle("Zależność wielkości kredytu od dochodów") +
  scale_fill_brewer(palette = "Set1")
```

Na wykresie można zauważyć zależność wielkości kredytu od dochodów. Im więcej zarabia dana osoba tym większy kredyt bierze. Punkty reprezentujące zarówno mężczyzn jak i kobiety są rozproszone po całym wykresie i trudno dostrzec jakąkolwiek zależność pomiędzy przynależnością do danej płci.Można zaobserwować wiele punktów odstających, niezgodnych z ogólnym trendem.\
Kolejnym wykresem, który stworzono był wykres słupkowy pokazujący udział osób mających problem ze spłatą kredytu w zależności od rodzaju kontraktu./

```{r, echo=FALSE}
ggplot(Data_hotdeck, aes(x = NAME_CONTRACT_TYPE, fill = TARGET_2)) +
  geom_bar() +
  xlab("Nazwa kontraktu") +
  ggtitle("Udział osób mających problem ze spłatą kredytu w zależności od rodzaju kontraktu") +
  scale_fill_brewer(palette = "Set1")
```

W danych można było wyróżnić dwa rodzaje kontraktów: kredyty odnawialne oraz pożyczki gotówkowe.Zdecydowaną wiekszość stanowią pożyczki gotówkowe, bo jest ich ponad 2000, natomiast kredyty odnawialne stanowią niewielką liczbę rekordów. Na stworzonym wykresie można zaobserwować, że zdecydowana wiekszość osób spłaca swoje zobowiązania. Na wykresach zaznaczono te osoby na kolor niebieski. Zarówno na słupku dotyczącym pożyczek gotówkowych, jak i tym z kredytami odnawialnymi większość obszaru słupka jest niebieska. Co istotne, obszar czerwony, odpowiadający ilość osób mających problem ze spłatą na słupku z pożyczkami gotówkowymi stanowi wiekszą część niż w przypadku kredytów odnawialnych. Może to sugerować, że większe problemy ze spłatą występują w przypadku osób korzystających z pożyczek gotówkowych.\
Kolejnym krokiem było stworzenie wykresów skrzypcowych dla osób, które spłacają i niespłacają swoich zobowiązań, w zależności od wielkości zaciągniętego zobowiązania.

```{r, echo=FALSE}
ggplot(Data_hotdeck, aes(x = TARGET_2, y = CREDIT_LOG, fill = TARGET_2)) +
  geom_violin(trim = FALSE) +
  geom_boxplot(width = 0.1, fill = "white", outlier.shape = NA) +
  theme_minimal() +
  labs(title = "Wykres skrzypcowy", x = "", y = "Wielkość kredytu") +
  scale_fill_brewer(palette = "Set1")
```

Grupę osób mających problem ze spłatą zobowiązania przedstawiono na czerwonym wykresie. Średnia zlogarytmowana wartość kredytu dla tej grupy wynosi około 13. Wartość są skoncentrowane, co może oznaczać, że problem ze spłacaniem zobowiązań mają ludzie o podobnej wartość kredytu. Wykres niebieski przedstawia grupę osób, które regularnie spłacają swoje zobowiązania. Średnia wartość kredytu jest podobna do grupy niespłacającej zobowiązań. To co rózni oba wykresy to ich zakres. W przypadku grupy spłacającej wartości zaciągniętego kredytu są bardziej zróznicowane i więcej jest tych powyżej wartości 13,5.\
W kolejnym kroku sworzono wykresy łączące w sobie informacje o poziomie edukacji, wielkości zaciągniętego kredytu oraz spłacania kredytu przez daną osobę.

```{r, echo=FALSE}
ggplot(Data_hotdeck, aes(x = INCOME_LOG, y = CREDIT_LOG)) +
  geom_point() +
  facet_wrap(TARGET_2 ~ NAME_EDUCATION_TYPE) +
  scale_fill_brewer(palette = "Set1")
```

Z wykresu można wywnioskować, że najliczniejsza grupa niespłacająca kredytu należy do poziomu edukacji "secondary/secondary special", najmniej liczna natomiast do "lower secondary". Wykres potwierdza fakt, że większość osób z bazy danych spłaca swoje zobowiązania.\

## Analiza opisowa

Analizę opisową rozpoczęto od stworzenia wykresu korelacji pomiędzy wybranymi zmiennymi numerycznymi wizualizowaną za pomocą funkcji z pakietu corrplot.\
Zakresem wartości korelacji jest zakres od -1 do 1, gdzie:

-   Korelacja bliska **1** oznacza silny dodatni związek między zmiennymi.

-   Korelacja bliska **0** wskazuje na brak związku.

-   Korelacja bliska **-1** sugeruje silną zależność ujemną.\

```{r, echo=FALSE}
corrplot(cor(Data_hotdeck[c("TARGET","CNT_CHILDREN", "AMT_INCOME_TOTAL", "AMT_CREDIT", "REGION_RATING_CLIENT", 
                            "APARTMENTS_AVG", "BASEMENTAREA_AVG", "YEARS_BUILD_AVG", "COMMONAREA_AVG", "ENTRANCES_AVG", "LANDAREA_AVG")]), 
         method = "number", type = "upper", diag =FALSE)
```

Najwyższą dodatnią korelację można zauważyć między APARTMENTS_AVG a ENTRANCES_AVG oraz BASEMENTAREA_AVG, co oznacza, że średnia powierzchnia mieszkań jest silnie powiązana z liczbą wejść do budynku oraz powierzchnią piwnicy.\
AMT_INCOME_TOTAL wykazuje umiarkowaną korelację z AMT_CREDIT (0.38), co sugeruje, że osoby o wyższym dochodzie częściej zaciągają wyższe kredyty.\
Wartość korelacji zmiennej REGION_RATING_CLIENT jest bliska zeru, co sugeruje brak silnego związku z innymi zmiennymi. Brak silnej korelacji między zmiennymi a TARGET sugeruje, że inne czynniki (np.zatrudnienie, poziom edukacji, typ pożyczki) mogą mieć większy wpływ na przewidywanie zmiennej dotyczącej regularnego spłacania i niespłacania kredytu.\

Następnie stworzono wykres przedstawiający macierz korelacji. Kolory użyte w wizualizacji pozwalają na szybkie rozpoznanie siły oraz kierunku zależności między zmiennymi – ciemnoniebieskie odcienie oznaczają silną dodatnią korelację, natomiast czerwone wskazują na ujemną korelację.\

```{r, echo=FALSE}
corr_matrix<-cor(Data_hotdeck[c("TARGET","CNT_CHILDREN", "AMT_INCOME_TOTAL", "AMT_CREDIT", "REGION_RATING_CLIENT", 
                                "APARTMENTS_AVG", "BASEMENTAREA_AVG", "YEARS_BUILD_AVG", "COMMONAREA_AVG", "ENTRANCES_AVG", "LANDAREA_AVG")])
corrplot(corr_matrix, method="color")

```

Dzięki zastosowaniu kolorów w odniesieniu do każdej korelacji między zmiennymi oraz usunięciu danych liczbowych z macierzy wizualizacja stała się bardziej czytelna. Najwyższe wartości korelacji oznaczające silne powiązania dodatnie można zauważyć w dolnym prawym rogu wykresu. Pokazują one powiązania między zmiennymi opisujacymi charakterystykę nieruchomości.\

W kolejnym etapie analizy zdefiniowano funkcję do obliczania statystyk opisowych dla wybranych zmiennych jakimi będą: wysokość kredytu oraz wysokość dochodów kredytobiorców. Zmienne te zostaną pogrupowane według zmiennej TARGET, aby sprawdzić różnice pomiędzy osobami spłacającymi kredyt oraz tymi, które posiadają problem ze spłatą.\
Statystykami obliczanymi w funkcji są:

-   minimum;

-   maksimum;

-   średnia arytmetyczna;

-   odchylenie standardowe;

-   mediana;

-   Q1 - pierwszy kwartyl;

-   Q3 - trzeci kwartyl;

-   skośność;

-   kurtoza.

\
Jako pierwszą przeanalizowano zmienną AMT_CREDIT opisującą wysokość kredytu.

```{r, echo=FALSE}
Data_hotdeck %>%
  select(AMT_CREDIT, TARGET_2) %>%
  group_by(TARGET_2) %>%
  summarize(minimum=min(AMT_CREDIT),
            maksimum=max(AMT_CREDIT),
            średnia=mean(AMT_CREDIT),
            odchylenie = sd(AMT_CREDIT),
            mediana = median(AMT_CREDIT),
            Q1=quantile(AMT_CREDIT,0.25),
            Q3=quantile(AMT_CREDIT,0.75),
            skośność= Skew(AMT_CREDIT),
            kurtoza=Kurt(AMT_CREDIT)) %>%
  kbl() %>%
  kable_classic_2(full_width = F) %>%
  kable_paper("striped", full_width = F) %>%
  column_spec(1:2, bold = F) %>%
  row_spec(1, bold = F, color = "black", background = "white")
```
Podsumowując dane z powyższej tabeli średnia kredytów w grupie "spłaca" jest wyższa niż w grupie "problemy ze spłatą", co może sugerować, że osoby spłacające kredyty mają wyższe zobowiązania.\
Najniższy kredyt w grupie posiadającej probelmy ze spłata wynosi 101880, a  najwyższy wynosi 3020760. W grupie osób bezproblemowo spłacających kredyt minimalną wartością udzielonego kredytu jestg 47970, a maksymalną 2517300.\
Mediana wartości kredytu dla osób z problemami ze spłatą wynosi 495000, co wskazuje, że połowa kredytów jest mniejsza lub równa tej kwocie, a połowa większa. W przypadku grupy bez problemów ze spłatą mediana jest bliska średniej, co oznacza, że kredyty w tej grupie są bardziej jednorodne pod względem wartości niż w grupie osób mających problemy ze spłatą.
Zmienność w obu grupach jest duża, ale grupa "problemy ze spłatą" ma wyższe odchylenie standardowe i wyższą kurtozę, co oznacza, że istnieje większe zróżnicowanie wysokości kredytów w tej grupie. \
Skośność w grupie "problemy ze spłatą" jest znacznie większa, co oznacza, że kredyty w tej grupie mają długie ogony w prawo (więcej bardzo wysokich kredytów). \
Z kolei kurtoza w grupie osób z problemami dotyczącymi spłaty wskazuje na rozkład z bardziej ekstremalnymi wartościami, podczas gdy w grupie spłacających bezproblemowo rozkład jest bardziej "normalny".\
Te różnice mogą sugerować, że osoby z problemami ze spłatą kredytu mają bardziej zróżnicowane kredyty, w tym więcej kredytów o bardzo wysokiej wartości, podczas gdy osoby spłacające kredyty mają bardziej jednorodny rozkład kredytów.\

Operację powtórzono dla zmiennej AMT_INCOME_TOTAL opisującej wysokość dochodów kredytobiorców.

```{r, echo=FALSE}
Data_hotdeck %>%
  select(AMT_INCOME_TOTAL, TARGET_2) %>%
  group_by(TARGET_2) %>%
  summarize(minimum=min(AMT_INCOME_TOTAL),
            maksimum=max(AMT_INCOME_TOTAL),
            średnia=mean(AMT_INCOME_TOTAL),
            odchylenie=sd(AMT_INCOME_TOTAL),
            mediana=median(AMT_INCOME_TOTAL),
            Q1=quantile(AMT_INCOME_TOTAL,0.25),
            Q3=quantile(AMT_INCOME_TOTAL,0.75),
            skośność=Skew(AMT_INCOME_TOTAL),
            kurtoza=Kurt(AMT_INCOME_TOTAL)) %>%
  kbl() %>%
  kable_classic_2(full_width = F) %>%
  kable_paper("striped", full_width = F) %>%
  column_spec(1:2, bold = F) %>%
  row_spec(1, bold = F, color = "black", background = "white")

```
W związku z wysokością dochodów kredytobiorców można stwierdzić, że średnie dochody w grupie "problemy ze spłatą" są nieco wyższe i wynoszą 1693556 w porównaniu do drigiej grupy z dochodami równymi 1643476. \
Mediana wynosi 135000, co oznacza, że połowa kredytobiorców zarabia mniej niż 135000, a połowa więcej.
Zmienność dochodów w obu grupach jest dość duża, z wysokim odchyleniem standardowym w każdej z nich. Dochody są mocno zróżnicowane w obu grupach, ale szczególnie wyraźne są w grupie "spłaca", gdzie wartości ekstremalne są jeszcze bardziej rozproszone (wyższa kurtoza).\
Skośność w obu grupach jest dodatnia, wskazując na większą liczbę osób z wyższymi dochodami w porównaniu do tych z niższymi dochodami. W grupie "spłaca" zauważalne jest silniejsze przesunięcie w stronę wyższych dochodów.\
Kurtoza w obu grupach wskazuje na rozkład z koncentracją wokół średnich wartości dochodów. W grupie "spłaca" koncentracja jest wyraźniejsza, z większą liczbą osób o dochodach w górnej części rozkładu.\
Wnioski mogą sugerować, że osoby spłacające kredyty mają bardziej jednorodny poziom dochodów, ale nadal istnieje grupa osób o bardzo wysokich dochodach. Z kolei osoby mające problemy ze spłatą mają bardziej zróżnicowane dochody, z większymi skrajnymi wartościami.\

Statystyki opisowe przygotowano także do cech budynków mieszkaniowych analizowanych uprzednio w macierzy korelacji. Pogrupowano je tak jak w dwóch powyższych tabelach ze względu na zmienna TARGET_2 oznaczającą problemy ze spłatą lub ich brak.

```{r, echo=FALSE}
Data_hotdeck %>%
  select(TARGET_2, APARTMENTS_AVG, BASEMENTAREA_AVG, YEARS_BUILD_AVG, COMMONAREA_AVG, ENTRANCES_AVG, LANDAREA_AVG) %>%
  pivot_longer(cols = -TARGET_2, names_to = "Zmienna", values_to = "VALUE") %>%
  group_by(Zmienna, TARGET_2) %>%
  summarize(minimum=min(VALUE),
            maksimum=max(VALUE),
            średnia=mean(VALUE),
            odchylenie=sd(VALUE),
            mediana=median(VALUE),
            Q1=quantile(VALUE,0.25),
            Q3=quantile(VALUE,0.75),
            skośność=Skew(VALUE),
            kurtoza=Kurt(VALUE)) %>%
  kbl() %>%
  kable_classic_2(full_width = F) %>%
  kable_paper("striped", full_width = F) %>%
  column_spec(1:2, bold = F) %>%
  row_spec(1, bold = F, color = "black", background = "white")
```  
Dla zmiennych APARTMENTS_AVG, BASEMENTAREA_AVG, COMMONAREA_AVG, ENTRANCES_AVG, LANDAREA_AVG minimum wynosi 0, co sugeruje, że niektóre nieruchomości nie mają w ogóle tych cech (np. brak wspólnych przestrzeni, piwnic, działek, wejść). Dla zmiennej YEARS_BUILD_AVG minimum wynosi 0.6192 dla osób z problemami w spłacie, co może wskazywać na stosunkowo nowe budynki w tej grupie, co jest ciekawe, ponieważ oczekiwalibyśmy, że starsze nieruchomości częściej będą miały problemy ze spłatą. \
Średnia w grupie "problemy ze spłatą" dla zmiennej APARTMENTS_AVG wynosi 0.0974, a w grupie "spłaca" wynosi 0.1189, co sugeruje, że osoby spłacające kredyt mają nieco większe mieszkania niż osoby z problemami. Podobnie, osoby spłacające kredyt mają nieco większe powierzchnie piwnic i działek, podczas gdy powierzchnia wspólnych przestrzeni jest bardzo podobna w obu grupach. Dzięki zmiennej opisującej wiek nieruchomości można zauważyć, że osoby z problemami mają średnio nieco starsze budynki, choć różnice są niewielkie.\
W przypadku zmiennych takich jak APARTMENTS_AVG czy LANDAREA_AVG, odchylenie standardowe wskazuje na dużą rozbieżność w wielkości nieruchomości, zwłaszcza w grupie spłacających kredyt. Natomiast dla zmiennych takich jak BASEMENTAREA_AVG czy COMMONAREA_AVG odchylenie jest mniejsze, co oznacza mniejszą zmienność w tych cechach.\
Mediana dla powierzchni mieszkań, piwnic i działek jest nieco wyższa w grupie spłacających kredyt, co sugeruje, że osoby te mieszkają w nieruchomościach o większej powierzchni w tych kategoriach. Mediana dla wspólnych przestrzeni i liczby wejść jest w zasadzie identyczna w obu grupach.
Wartości skośności wskazują, że w obu grupach występuje przesunięcie w stronę wyższych wartości, ale szczególnie mocne w grupie spłacających kredyt. Dla zmiennych takich jak BASEMENTAREA_AVG czy YEARS_BUILD_AVG skośność jest wyraźnie wyższa w grupie spłacających kredyt, co sugeruje większe odchylenie w tych grupach.\
Kurtoza wskazuje na silną koncentrację danych wokół średnich wartości w obu grupach, z wyraźnie większą koncentracją w grupie spłacających kredyt. Wartości kurtozy są szczególnie wysokie w przypadku zmiennych takich jak APARTMENTS_AVG czy BASEMENTAREA_AVG, co sugeruje, że w tych grupach pojawiają się skrajne przypadki (bardzo duże mieszkania, piwnice itp.).

## Wnioskowanie (testy statystyczne)

W ramach niniejszego rozdziału przeprowadzono analizę statystyczną zbioru danych. Ma ona na celu zbadanie zależności pomiędzy wybranymi zmiennymi. Wykorzystane metody statystyczne pozwolą na ocenę istotności różnic oraz zidentyfikowanie potencjalnych zależności w danych.

Dokonano kategoryzacji danych liczbowych dotyczących dochodów (AMT_INCOME_TOTAL) oraz kwoty kredytu (AMT_CREDIT) na pięć równych przedziałów, co pozwala na lepsze przedstawienie struktury tych zmiennych. W celu wizualizacji wyników wykorzystano histogramy oraz wykresy słupkowe, co ułatwia interpretację rozkładów.

```{r, echo=FALSE}
data_kat_income <- binning(Data_hotdeck$AMT_INCOME_TOTAL, nbins = 5, type = "equal")
summary(data_kat_income)
plot(data_kat_income)
```

```{r, echo=FALSE}
data_kat_credit <- binning(Data_hotdeck$AMT_CREDIT, nbins = 5, type = "equal")
summary(data_kat_credit)
plot(data_kat_credit)
```

Pierwsza hipoteza, którą zdecydowano się postawić, ma na celu zbadanie czy poziom edukacji (NAME_EDUCATION_TYPE) ma istotny wpływ na problemy ze spłatą kredytu (TARGET_2).\
Hipotezy statystyczne:\
- H₀: Nie ma istotnej zależności między poziomem edukacji, a problemami ze spłatą kredytu. Rozkład wartości TARGET_2 jest równomierny w różnych grupach edukacyjnych.\
- H₁: Istnieje istotna zależność między poziomem edukacji, a problemami ze spłatą kredytu. Pewne grupy edukacyjne mają wyraźnie większe lub mniejsze ryzyko problemów kredytowych.

```{r, echo=FALSE}
ggpiestats(
  data = Data_hotdeck,
  x = data_kat_credit,
  y = NAME_FAMILY_STATUS,
  palette = "Set1",
  title = "Rozkład pięciu przedziałów kredytów w zależności od statusu rodziny"
)  
```

Wartość p=0.01 wskazuje na to, że poziom edukacji wpływa na problemy ze spłatą kredytu. Współczynnik V Craméra (0.06) sugeruje słabą zależność między zmiennymi.P-value jest mniejsze niż poziom istotności α=0.05. Odrzucamy hipotezę zerową. Oznacza to, że istnieje statystycznie istotna zależność między poziomem edukacji, a problemami ze spłatą kredytu.\

Na podstawie rozkładu poziomu edukacji w zależności od problemów ze spłatą kredytu można zauważyć pewne różnice. Osoby z wykształceniem średnim dominują w obu grupach, ale ich udział jest większy wśród osób mających problemy ze spłatą kredytu (75%). Osoby z wykształceniem wyższym częściej spłacają kredyt regularnie (27%) w porównaniu do tych, które mają problemy (18%).

Druga postawiona hipoteza związana jest ze sprawdzeniem, czy istnieje zależność między przedziałem kwot branego kredytu, a statusem rodzinnym. Chcemy zobaczyć jak np. małżeństwa czy osoby samotne różnią się pod względem wielkości kredytów, które biorą. Zdecydowano się na wizualizację kołową.

Hipotezy statystyczne:\
- H₀: Nie ma zależności między przedziałem kwoty kredytu (data_kat_credit), a statusem rodzinnym (NAME_FAMILY_STATUS). Rozkład wielkości kredytów jest taki sam we wszystkich grupach rodzinnych.\
- H₁: Istnieje zależność między przedziałem kwoty kredyt, a statusem rodzinnym. Rozkład wielkości kredytów różni się w zależności od statusu rodziny.

```{r, echo=FALSE}
ggpiestats(
  data = Data_hotdeck,
  x = data_kat_credit,
  y = NAME_FAMILY_STATUS,
  palette = "Set1",
  title = "Rozkład pięciu przedziałów kredytów w zależności od statusu rodziny"
)  
```

Na wykresie przedstawiono wyniki testu chi-kwadrat dla każdej grupy.\
Dla każdej grupy p-value \< 0.05, co oznacza, że odrzucamy hipotezę zerową. Istnieje istotny statystycznie związek między przedziałem kwoty kredytu, a statusem rodzinnym. Współczynnik V Craméra (0.06), wskazuje na słaby, ale istotny związek między zmiennymi.\
Najniższy przedział kredytów dominuje we wszystkich grupach rodzinnych:

Największy udział najniższego przedziału kredytów (49770 - 642528) występuje w grupach: Widow (75%), Single / not married (74%), oraz Separated (71%). W grupie Married udział najniższego przedziału wynosi 59%, co oznacza, że małżeństwa częściej biorą kredyty w wyższych przedziałach niż inne grupy.\

Wyższe przedziały kredytów są bardziej popularne wśród osób pozostających w małżeństwie. W grupie Married, aż 41% osób korzysta z kredytów w wyższych przedziałach, w tym 8% z najwyższego przedziału. W innych grupach udział wyższych przedziałów kredytów jest znacznie mniejszy.\
Osoby samotne, wdowy i osoby po rozwodzie częściej biorą niższe kredyty. W grupach Single, Widow i Separated, kredyty z wyższych przedziałów stanowią jedynie niewielki procent wszystkich przypadków, co sugeruje ograniczone możliwości finansowe tych grup.

Wykorzystano również analizę waraincji (ANOVA). Celem tego testu jest zrozumienie, jak typ zawodu oraz sytuacja mieszkaniowa wpływają na to, czy klient ma problemy ze spłatą kredytu.\
W modelu uwzględniono interakcję między zmiennymi OCCUPATION_TYPE i NAME_HOUSING_TYPE. Oznacza to, że sprawdzamy nie tylko główny wpływ każdej z tych zmiennych na TARGET, ale także, czy wpływ jednej zmiennej zależy od poziomu drugiej zmiennej.

W przypadku tego modelu ANOVA postawiono następujące hipotezy dotyczące efektów:\
- H₀:Typ zawodu OCCUPATION_TYPE nie ma wpływu na zmienną zależną TARGET, a typ sytuacji mieszkaniowej NAME_HOUSING_TYPE nie ma wpływu na zmienną zależną TARGET.\
- H₁:Typ zawodu OCCUPATION_TYPE ma istotny wpływ na zmienną zależną TARGET, a Typ sytuacji mieszkaniowej NAME_HOUSING_TYPE ma istotny wpływ na zmienną zależną TARGET.\
Postawiono również hipotezy dotyczące interakcji:\
- H₀: Nie ma interakcji między typem zawodu (OCCUPATION_TYPE), a typem sytuacji mieszkaniowej (NAME_HOUSING_TYPE) w odniesieniu do zmiennej zależnej TARGET.\
- H₁: Istnieje interakcja między typem zawodu (OCCUPATION_TYPE), a typem sytuacji mieszkaniowej (NAME_HOUSING_TYPE) w odniesieniu do zmiennej zależnej TARGET.\

```{r, echo=FALSE}
mod <- aov(
  TARGET ~ OCCUPATION_TYPE * NAME_HOUSING_TYPE,
  data = Data_hotdeck
)
```

```{r, echo=FALSE}
summary(mod)
ggcoefstats(mod, title = "Test Anova dla zmiennej TARGET w zależności od typu zawodu i typu nieruchomości")
```

Typ zawodu (OCCUPATION_TYPE) ma istotny wpływ na to, czy klient ma problemy ze spłatą kredytu, ponieważ wartość p-value jest bardzo mała (6.14e-10), odrzucamy hipotezę zerową. Sytuacja mieszkaniowa (NAME_HOUSING_TYPE) również ma istotny wpływ na problemy ze spłatą kredytu, z wartością p-value wynoszącą 0.00293, również odrzucamy w takim wypadku hipotezę zerową.\
Interakcja między typem zawodu, a sytuacją mieszkaniową jest istotna statystycznie (p = 0.01130), oznacza to że wpływ jednego czynnika na TARGET (problemy ze spłatą kredytu) zależy od poziomu drugiego czynnika. Istotna interakcja pokazuje, że zawód i sytuacja mieszkaniowa razem mają bardziej złożony wpływ na to, czy klient ma problemy ze spłatą kredytu, niż gdybyśmy oceniali te zmienne oddzielnie.

## Podsumowanie i wnioski końcowe
